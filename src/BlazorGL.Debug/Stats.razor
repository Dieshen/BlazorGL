@using BlazorGL.Core.Rendering

<div class="blazorgl-stats" style="@GetStyle()">
    <div class="blazorgl-stats-panel">
        <div class="blazorgl-stats-label">FPS</div>
        <div class="blazorgl-stats-value" style="color: @(Performance.FPS >= 55 ? "#0f0" : Performance.FPS >= 30 ? "#ff0" : "#f00")">
            @Performance.FPS.ToString("F1")
        </div>
    </div>

    <div class="blazorgl-stats-panel">
        <div class="blazorgl-stats-label">Frame Time</div>
        <div class="blazorgl-stats-value">@Performance.FrameTime.ToString("F2") ms</div>
    </div>

    <div class="blazorgl-stats-panel">
        <div class="blazorgl-stats-label">Draw Calls</div>
        <div class="blazorgl-stats-value">@Performance.DrawCalls</div>
    </div>

    <div class="blazorgl-stats-panel">
        <div class="blazorgl-stats-label">Triangles</div>
        <div class="blazorgl-stats-value">@FormatNumber(Performance.Triangles)</div>
    </div>

    @if (ShowCulling)
    {
        <div class="blazorgl-stats-panel">
            <div class="blazorgl-stats-label">Objects</div>
            <div class="blazorgl-stats-value">@Performance.TotalObjects</div>
        </div>

        <div class="blazorgl-stats-panel">
            <div class="blazorgl-stats-label">Culled</div>
            <div class="blazorgl-stats-value" style="color: #0f0">@Performance.CulledObjects (@GetCullPercentage())</div>
        </div>
    }
</div>

@code {
    /// <summary>
    /// The performance statistics to display
    /// </summary>
    [Parameter]
    public PerformanceStats Performance { get; set; } = new();

    /// <summary>
    /// Position of the stats overlay
    /// </summary>
    [Parameter]
    public StatsPosition Position { get; set; } = StatsPosition.TopLeft;

    /// <summary>
    /// Whether to show culling statistics
    /// </summary>
    [Parameter]
    public bool ShowCulling { get; set; } = true;

    /// <summary>
    /// Opacity of the stats panel (0.0 to 1.0)
    /// </summary>
    [Parameter]
    public float Opacity { get; set; } = 0.85f;

    private string GetStyle()
    {
        var baseStyle = $"opacity: {Opacity};";

        return Position switch
        {
            StatsPosition.TopLeft => baseStyle + "top: 10px; left: 10px;",
            StatsPosition.TopRight => baseStyle + "top: 10px; right: 10px;",
            StatsPosition.BottomLeft => baseStyle + "bottom: 10px; left: 10px;",
            StatsPosition.BottomRight => baseStyle + "bottom: 10px; right: 10px;",
            _ => baseStyle + "top: 10px; left: 10px;"
        };
    }

    private string FormatNumber(int num)
    {
        if (num >= 1_000_000)
            return $"{num / 1_000_000.0:F2}M";
        if (num >= 1_000)
            return $"{num / 1_000.0:F1}K";
        return num.ToString();
    }

    private string GetCullPercentage()
    {
        if (Performance.TotalObjects == 0)
            return "0%";
        var percent = (Performance.CulledObjects * 100.0f) / Performance.TotalObjects;
        return $"{percent:F1}%";
    }
}
